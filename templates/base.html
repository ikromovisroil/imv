<!DOCTYPE html>{% load static %}
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  {% block title %}
  {% endblock title %}

  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="{% static 'img/favicon.png' %}" rel="icon">
  <link href="{% static 'img/apple-touch-icon.png' %}" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/boxicons/css/boxicons.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/quill/quill.snow.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/quill/quill.bubble.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/remixicon/remixicon.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/simple-datatables/style.css' %}" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="{% static 'css/style.css' %}" rel="stylesheet">

    <style>
            /* Kengroq qilib qo'yish */
    .notifications {
        width: 380px !important;
        max-height: 450px;
        overflow-y: auto;
        border-radius: 12px;
        padding: 5px 0;
    }

    /* Har bir item */
    .notification-item {
        display: flex;
        gap: 12px;
        padding: 12px 16px;
        transition: background 0.2s;
    }

    .notification-item:hover {
        background: #f3f6ff;
        cursor: pointer;
    }

    /* Iconlarni kattalashtirish */
    .notification-item i {
        font-size: 28px;
        margin-top: 4px;
    }
    </style>

</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
      <a href="{% url 'index' %}" class="logo d-flex align-items-center">
        <img src="{% static 'img/logo.png' %}" alt="">
        <span class="d-none d-lg-block">IMV</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->

    <nav class="header-nav ms-auto">
      <ul class="d-flex align-items-center">

        <li class="nav-item dropdown">

            <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown" id="deed-bell">
                <i class="bi bi-bell"></i>

                {% if deed_notification_count > 0 %}
                    <span class="badge bg-primary badge-number">
                        {{ deed_notification_count }}
                    </span>
                {% endif %}
            </a>

            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow notifications">

                <li class="dropdown-header d-flex justify-content-between align-items-center px-3">
                    <span class="fw-bold">Sizdagi yangiliklar</span>
                    <span class="badge bg-primary">{{ deed_notification_count }}</span>
                </li>

                <li><hr class="dropdown-divider"></li>

                {% for d in deed_notifications %}
                <li class="notification-item">

                    <!-- ICON -->
                    <i class="bi {{ d.notif_icon }}"></i>

                    <div>
                        <!-- Kimdan -->
                        <h4 class="mb-1" style="font-size:16px;">
                            {{ d.sender.user.get_full_name }}
                        </h4>

                        <!-- RECEIVER BO‘LSA: yangi hujjat -->
                        {% if d.receiver.user.id == request.user.id and d.status == 'viewed' %}
                            <p class="text-warning">Yangi dalolatnoma keldi</p>

                        <!-- SENDER BO‘LSA: tasdiqlangan-->
                        {% elif d.sender.user.id == request.user.id and d.status == 'approved' %}
                            <p class="text-success">Yuborgan dalolatnomangiz tasdiqlandi</p>

                        <!-- SENDER BO‘LSA: rad etilgan -->
                        {% elif d.sender.user.id == request.user.id and d.status == 'rejected' %}
                            <p class="text-danger">Yuborgan dalolatnomangiz rad etildi</p>
                        {% endif %}

                        <!-- vaqt -->
                        <p class="small text-muted">{{ d.date_edit|timesince }} oldin</p>
                    </div>

                </li>
                <li><hr class="dropdown-divider"></li>
                {% endfor %}
            </ul>

        </li>


        <li class="nav-item dropdown pe-3">

          <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
            <img src="{% static 'img/profile-img.jpg' %}" alt="Profile" class="rounded-circle">
            <span class="d-none d-md-block dropdown-toggle ps-2">{{ user.get_full_name }}</span>
          </a><!-- End Profile Iamge Icon -->

          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">


            <li class="dropdown-header">
              <h6>{{ user.get_full_name }}</h6>
              <span>{{ user.user.rank.name }}</span>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="https://t.me/Isroil_0309">
                <i class="bi bi-question-circle"></i>
                <span>Yordam</span>
              </a>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="{% url 'logout' %}">
                <i class="bi bi-box-arrow-right"></i>
                <span>Chiqish</span>
              </a>
            </li>

          </ul><!-- End Profile Dropdown Items -->
        </li><!-- End Profile Nav -->

      </ul>
    </nav><!-- End Icons Navigation -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link " href="{% url 'index' %}">
          <i class="bi bi-grid"></i>
          <span>Dashboard</span>
        </a>
      </li><!-- End Dashboard Nav -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'contact' %}">
          <i class="bi bi-envelope"></i>
          <span>Arizalar</span>
        </a>
      </li><!-- End Profile Page Nav -->
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#components-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Texnikalar ro'yxati</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="components-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          {% for i in global_categorys %}
          <li>
            <a href="{% url 'technics' i.slug %}">
              <i class="bi bi-circle"></i><span>{{ i.name }}</span>
            </a>
          </li>
          {% endfor %}
          <li>
            <a href="{% url 'technics' %}">
              <i class="bi bi-circle"></i><span>Hammasi</span>
            </a>
          </li>
        </ul>
      </li><!-- End Components Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#forms-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-layout-text-window-reverse"></i><span>Tashkilotlar ro'yxati</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="forms-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          {% for i in global_organizations %}
          <li>
            <a href="{% url 'organization' i.slug %}">
              <i class="bi bi-circle"></i><span>{{ i.name }}</span>
            </a>
          </li>
          {% endfor %}
        </ul>
      </li><!-- End Forms Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'document_get' %}">
          <i class="bi bi-file-earmark"></i>
              <span>Dalolatnoma</span>
        </a>
      </li><!-- End F.A.Q Page Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'hisobot_get' %}">
          <i class="bi bi-card-list"></i>
          <span>Hisobot</span>
        </a>
      </li><!-- End Register Page Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'logout' %}">
          <i class="bi bi-box-arrow-in-right"></i>
          <span>chiqish</span>
        </a>
      </li><!-- End Login Page Nav -->
    </ul>

  </aside><!-- End Sidebar-->

  {% block content %}

  {% endblock content %}

  <div class="container">
      {% if messages %}
        <div style="z-index: 312;" class="shadow-sm position-fixed end-0 bottom-0 mt-4">
          {% for message in messages  %}
            <div style="width: 20rem; opacity:0.9 " class="alert alert-{{message.tags}} alert-dismissible fade show" role="alert">
               {{message}}
            </div>
            {% endfor %}
        </div>
      {% endif %}
  </div>

  <!-- ======= Footer ======= -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="{% static 'vendor/apexcharts/apexcharts.min.js' %}"></script>
  <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'vendor/chart.js/chart.umd.js' %}"></script>
  <script src="{% static 'vendor/echarts/echarts.min.js' %}"></script>
  <script src="{% static 'vendor/quill/quill.min.js' %}"></script>
  <script src="{% static 'vendor/simple-datatables/simple-datatables.js' %}"></script>
  <script src="{% static 'vendor/tinymce/tinymce.min.js' %}"></script>
  <script src="{% static 'vendor/php-email-form/validate.js' %}"></script>

  <!-- Template Main JS File -->
  <script src="{% static 'js/main.js' %}"></script>
  <script src="{% static 'js/document.js' %}"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const dropdown = document.querySelector('[data-bs-toggle="dropdown"]');

    dropdown.addEventListener('shown.bs.dropdown', function () {
        fetch("{% url 'deed_mark_seen' %}");
    });
});
</script>
</body>

</html>